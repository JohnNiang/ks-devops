setup:
  env: kind
  file: ../../common/kind.yaml
  timeout: 60m
  steps:
    - name: Install ks-devops via helm chart
      command: |
        helm repo add ks-devops https://kubesphere-sigs.github.io/ks-devops-helm-chart/
        helm repo update
        helm install ks-devops ks-devops/ks-devops -n kubesphere-devops-system --create-namespace \
                 --set image.pullPolicy=Always --set jenkins.ksAuth.enabled=true
      wait:
        - namespace: kubesphere-devops-system
          resource: pod
          for: condition=Ready
  kind:
    expose-ports:
      - namespace: kubesphere-devops-system
        resource: deployment/devops-apiserver
        port: 9090

trigger:
  action: http
  interval: 3s
  times: 5
  url: http://${deployment/devops-apiserver_host}:${deployment/devops-apiserver_9090}/
  method: GET

verify:
  retry:
    count: 0
    interval: 10s
